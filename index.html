<!DOCTYPE html>
<meta charset="utf-8">
<style>
	body {
		font: 10px sans-serif;
	}

    rect {
        fill: none;
        stroke: red;
    }

    text {
        stroke: black;
    }
</style>
<body>

<script src="d3.js" charset="utf-8"></script>

<script>
    // taken from http://stackoverflow.com/a/901144
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    
    // NOT SECURE:
    // might also load remote file!
    // DO NOT use this script on a public server
    var xmlfile = getParameterByName('xmlfile');
    if (!xmlfile) {
        xmlfile = '1992_93.pdf.xml'
    }

    var doc = null;
    var svg = null;

    d3.xml(xmlfile, 'application/xml', function (d) {
        doc = d;

        var pages = doc.getElementsByTagName('page');
        displayPage(pages[0])
    });

    function displayPage(p) {
        var w = p.attributes['width'].value;
        var h = p.attributes['height'].value;

        var fontspecElems = p.getElementsByTagName('fontspec');
        var fontspecs = {};
        for (var i = 0; i < fontspecElems.length; i++) {
            var spec = fontspecElems[i].attributes;
            fontspecs[spec.id.value] = {
                'size': spec.size.value,
                'family': spec.family.value
            }
        }

        function textStyle(textNode, prop) {
            var spec = fontspecs[textNode.attributes['font'].value];
            return spec[prop];
        }

        if (svg != null) {
            svg.remove();
        }

        svg = d3.select("body").append("svg")
                .attr("width", w)
                .attr("height", h);

        var textNodes = p.getElementsByTagName('text');

        var textGroups = svg.selectAll('.text')
                .data(textNodes).enter()
                .append('g')
                .attr('class', 'text')
                .attr('transform', function (d) {
                    var x = d.attributes['left'].value;
                    var y = d.attributes['top'].value;
                    return 'translate(' + x + ', ' + y + ')';
                });

        var textRects = textGroups.append('rect')
                .attr('width', function (d) { return d.attributes['width'].value; })
                .attr('height', function (d) { return d.attributes['height'].value; });
        var textInRects = textGroups.append('text')
                .attr('dy', function (d) { return d.attributes['height'].value / 1.4; })
                .style('font-size', function (d) { return textStyle(d, 'size') })
                .style('font-family', function (d) { return textStyle(d, 'family') })
                .text(function (d) { return d.childNodes[0].nodeValue });
    }
</script>

</body>
